# 云原生博客与知识库系统 - 工作计划书

本文档按「先写什么、再写什么」给出可逐步执行的工作计划，不涉及具体时间节点。最后一步为扩展功能，具体内容后续再定。

---

## 如何使用本计划（打勾看进度）

- **打勾**：把该步骤前的 `- [ ]` 改成 `- [x]`（在方括号里输入字母 x），保存后即可看到勾选效果。
- **看进度**：往下扫一眼，所有已勾选的就是「已完成」，第一个未勾的就是「当前该做的」。
- **建议**：做完一小步就勾一下，这样随时能看清自己做到哪一步了。

---

## 阶段一：仓库与基础文档

- [ ]  **1.1** 确认根目录有 `.gitignore`，且包含：`target/`、`node_modules/`、`.idea/`、`*.iml`、`dist/`、`.env.local` 等；没有则补充。
- [ ]  **1.2** 确认 `docs/` 下已有：`任务书.txt`、`技术栈.md`、本 `工作计划书.md`；根目录有 `README.md`。
- [ ]  **1.3** （可选）在 `docs/` 下新增 `API 接口文档.md` 或 `数据库设计.md`，后续随开发补充。

---

## 阶段二：基础设施（先能跑起来）

- [ ]  **2.1** 在项目根下新建目录 `infrastructure/`。
- [ ]  **2.2** 在 `infrastructure/mysql/` 下新建 `schema.sql`。
- [ ]  **2.3** 在 `schema.sql` 里写建库语句（如 `CREATE DATABASE blog`）。
- [ ]  **2.4** 在 `schema.sql` 里建表 `user`（id, username, password, nickname, role, created_at 等）。
- [ ]  **2.5** 在 `schema.sql` 里建表 `article`、`category`、`tag`、`article_tag`（文章与标签多对多）。
- [ ]  **2.6** 在 `schema.sql` 里建表 `comment`（id, article_id, user_id, content, parent_id, created_at 等）。
- [ ]  **2.7** （可选）在 `infrastructure/mysql/` 下新建 `data.sql`，写初始管理员、默认分类等。
- [ ]  **2.8** 在 `infrastructure/` 下新建 `docker-compose.yml`，加入服务：`mysql`（8.x）、`redis`、`nacos`（若用）。
- [ ]  **2.9** 在 `docker-compose.yml` 中配置 MySQL 数据卷，并把 `mysql/schema.sql` 挂载到 `/docker-entrypoint-initdb.d` 实现首次启动自动建表。
- [ ]  **2.10** 确认端口与各服务后续的 `application.yml` 一致（如 MySQL 3306、Redis 6379、Nacos 8848）。
- [ ]  **2.11** （可选）新建 `infrastructure/redis/redis.conf` 或 `infrastructure/nacos/` 配置示例，可后补。

---

## 阶段三：认证服务（auth-service）

依赖：无（仅 MySQL、Redis 可选）。先做认证，后续网关和前端都依赖「登录与 Token」。

- [ ]  **3.1** 在 `services/auth-service/` 下创建 Maven 工程目录结构。
- [ ]  **3.2** 写 `services/auth-service/pom.xml`，加入：Spring Boot 3.x、Spring Cloud、MySQL 驱动、MyBatis Plus、Spring Security、JWT（如 jjwt）、Lombok、Nacos Discovery/Config（若用）。
- [ ]  **3.3** 建包：`controller`、`service`、`service.impl`、`mapper`、`entity`、`config`、`dto`、`util`。
- [ ]  **3.4** 写 `src/main/resources/application.yml`：服务名、端口（如 8081）、数据库 URL/用户名/密码（与 infrastructure 中 MySQL 一致）。
- [ ]  **3.5** （可选）写 `application-dev.yml` 或在此补充 Redis、Nacos 地址。
- [ ]  **3.6** 写 `entity/User.java`，与 `user` 表字段对应，使用 Lombok。
- [ ]  **3.7** 写 `mapper/UserMapper.java`，继承 MyBatis Plus 的 `BaseMapper<User>`。
- [ ]  **3.8** 写 `service/UserService.java` 接口（按用户名查用户、注册、校验等）。
- [ ]  **3.9** 写 `service/impl/UserServiceImpl.java` 实现类（注册时密码加密）。
- [ ]  **3.10** 写 `util/JwtUtil.java`（或放 config）：生成 JWT、解析、校验。
- [ ]  **3.11** 写 `config/SecurityConfig.java`：放行登录/注册接口，其余需认证；可配置 JWT 过滤器。
- [ ]  **3.12** 写 `controller/AuthController.java`：注册 `POST /auth/register`、登录 `POST /auth/login`（返回 JWT）。
- [ ]  **3.13** 写启动类 `AuthServiceApplication.java`（包根下，`@SpringBootApplication`）。
- [ ]  **3.14** 启动 MySQL（及 Redis、Nacos），运行 auth-service，用 REST Client 或 Postman 调注册、登录，确认返回 JWT。

---

## 阶段四：博客内容服务（blog-service）

依赖：MySQL。不依赖 auth-service（仅存 user_id）；评论服务后续会依赖本服务。

- [ ]  **4.1** 在 `services/blog-service/` 下创建 Maven 工程目录结构。
- [ ]  **4.2** 写 `pom.xml`：Spring Boot、MyBatis Plus、MySQL、Nacos、OpenFeign、Lombok 等。
- [ ]  **4.3** 写 `application.yml`：服务名、端口（如 8082）、数据库、Nacos。
- [ ]  **4.4** 写 `entity/Article.java`、`Category.java`、`Tag.java`（与表对应；如需关联表可再加实体或 DTO）。
- [ ]  **4.5** 写 `mapper/ArticleMapper.java`、`CategoryMapper.java`、`TagMapper.java`，继承 BaseMapper。
- [ ]  **4.6** 写 `service/ArticleService.java` 接口及 `impl`：文章 CRUD、分页列表、按分类/标签查、文章-标签多对多与摘要处理。
- [ ]  **4.7** 写 `service/CategoryService`、`TagService` 接口及实现类。
- [ ]  **4.8** 写 `controller/ArticleController.java`：文章列表（分页）、详情、创建、更新、删除。
- [ ]  **4.9** 写 `CategoryController.java`、`TagController.java`（或合并到文章相关接口，按你设计来）。
- [ ]  **4.10** 写统一返回格式（如 `Result<T>`）和统一异常处理（`@ControllerAdvice`）。
- [ ]  **4.11** 写启动类 `BlogServiceApplication.java`。
- [ ]  **4.12** 启动 blog-service，用接口测试文章、分类、标签的增删改查。

---

## 阶段五：评论服务（comment-service）

依赖：MySQL、blog-service（用 OpenFeign 校验文章是否存在）。

- [ ]  **5.1** 在 `services/comment-service/` 下创建 Maven 工程目录结构。
- [ ]  **5.2** 写 `pom.xml`：Spring Boot、MyBatis Plus、MySQL、Nacos、OpenFeign。
- [ ]  **5.3** 写 `application.yml`：服务名、端口（如 8083）、数据库、Nacos；Feign 的 blog-service 地址或服务名。
- [ ]  **5.4** 写 `client/BlogServiceClient.java`：声明式接口，如 `GET /articles/{id}` 或「校验文章是否存在」的接口。
- [ ]  **5.5** 写 `entity/Comment.java`，与 `comment` 表对应。
- [ ]  **5.6** 写 `mapper/CommentMapper.java`，继承 BaseMapper。
- [ ]  **5.7** 写 `service/CommentService` 接口及实现：发表评论前调 blog-service 校验文章、按文章查评论列表、删除（可选）。
- [ ]  **5.8** 写 `controller/CommentController.java`：按文章查评论 GET、发表 POST、删除 DELETE（可选）。
- [ ]  **5.9** 写启动类 `CommentServiceApplication.java`。
- [ ]  **5.10** 先启动 blog-service，再启动 comment-service；调评论接口，确认能校验文章并写入评论。

---

## 阶段六：API 网关（gateway）

依赖：Nacos（建议已用），路由到 auth、blog、comment。

- [ ]  **6.1** 在 `gateway/` 下创建 Maven 工程目录结构。
- [ ]  **6.2** 写 `pom.xml`：Spring Cloud Gateway、Nacos Discovery（可选 Nacos Config）。
- [ ]  **6.3** 写 `application.yml`：端口（如 8080）；路由 `/api/auth/**` → auth-service，`/api/blog/**`（或 `/api/articles/**`）→ blog-service，`/api/comments/**` → comment-service。
- [ ]  **6.4** 在网关中配置 CORS（若需跨域）。
- [ ]  **6.5** 写全局过滤器或 Gateway Filter：对 `/api/auth/login`、`/api/auth/register` 放行；其他 `/api/**` 从 Header 取 JWT 并校验，无效返回 401。
- [ ]  **6.6** 写启动类 `GatewayApplication.java`。
- [ ]  **6.7** 启动 Nacos、auth、blog、comment、gateway；通过 8080 访问各路径，确认路由与鉴权正常。

---

## 阶段七：前端（frontend）

依赖：后端网关与各接口已就绪（至少接口约定清楚）。

- [ ]  **7.1** 在 `frontend/` 下用 Vite 创建 Vue 3 项目（如 `npm create vite@latest . -- --template vue-ts` 或 vue）。
- [ ]  **7.2** 安装依赖：`vue-router`、`pinia`、`axios`、`element-plus`、`sass`（可选）。
- [ ]  **7.3** 写 `src/main.ts`：挂载 App、引入 Element Plus、全局样式。
- [ ]  **7.4** 写 `src/App.vue`：根组件，含 `<router-view>`。
- [ ]  **7.5** 写 `src/router/index.ts`：路由表（首页、登录、文章列表、文章详情、后台管理入口等占位）。
- [ ]  **7.6** 写 `src/api/request.ts`：axios 实例，baseURL 指向网关（如 `http://localhost:8080/api`），请求拦截器加 Token。
- [ ]  **7.7** 写 `src/stores/user.ts`（Pinia）：用户信息、Token、登录/登出方法。
- [ ]  **7.8** 写 `src/api/auth.ts`：登录、注册接口封装。
- [ ]  **7.9** 写 `src/api/article.ts`：文章列表、详情、创建、更新、删除。
- [ ]  **7.10** 写 `src/api/category.ts`、`tag.ts`：分类、标签列表等。
- [ ]  **7.11** 写 `src/api/comment.ts`：评论列表、发表评论。
- [ ]  **7.12** 写登录页 `views/Login.vue`：表单、调登录接口、存 Token、跳转首页。
- [ ]  **7.13** 写首页/文章列表 `views/Home.vue` 或 `ArticleList.vue`：列表、分页、点进详情。
- [ ]  **7.14** 写文章详情 `views/ArticleDetail.vue`：标题、正文、分类/标签、评论列表与发表评论。
- [ ]  **7.15** 写后台布局 `views/admin/Layout.vue`：侧栏+顶栏+内容区。
- [ ]  **7.16** 写后台文章管理 `views/admin/ArticleManage.vue`：表格、新增/编辑/删除、调 article/category/tag 接口。
- [ ]  **7.17** （可选）写后台分类/标签管理页，或合在文章管理里；按需写 `components/ArticleCard.vue`、`CommentList.vue` 等。
- [ ]  **7.18** 在 `router` 里加 `beforeEach`：需要登录的路径无 Token 则跳转登录页。
- [ ]  **7.19** 本地先后端、再前端；跑通登录、列表、详情、评论、后台文章 CRUD 全流程。

---

## 阶段八：容器化与部署（deploy）

- [ ]  **8.1** 为 auth-service 写 Dockerfile（多阶段：Maven 打包 + JRE 运行 jar）；可放在 `deploy/` 或 `services/auth-service/`。
- [ ]  **8.2** 为 blog-service、comment-service、gateway 各写一个 Dockerfile。
- [ ]  **8.3** （可选）写 `deploy/docker-compose.yml`：MySQL、Redis、Nacos、auth、blog、comment、gateway 一键起，环境变量与端口与各服务一致。
- [ ]  **8.4** 在 `deploy/k8s/` 下写基础设施：MySQL、Redis、Nacos 的 Deployment、Service、ConfigMap/Secret（若在 K8s 里起）。
- [ ]  **8.5** 在 `deploy/k8s/` 下写 auth-service、blog-service、comment-service、gateway 的 Deployment 与 Service。
- [ ]  **8.6** 用 ConfigMap/Secret 存应用配置与 DB 密码；若需对外访问，写 Ingress 暴露 gateway。
- [ ]  **8.7** 在本地或云上起最小 K8s 集群；按顺序部署基础设施 → 各微服务 → 网关；用浏览器或 curl 验证访问。

---

## 阶段九：脚本与 CI/CD

- [ ]  **9.1** 在 `scripts/` 下写 `build.sh` 或 `build.ps1`：依次对各服务 `mvn package`、对前端 `npm run build`。
- [ ]  **9.2** 写 `build-images.sh`：对各服务打 Docker 镜像并打 tag。
- [ ]  **9.3** 写 `push-images.sh`：推送镜像到镜像仓库（如 Harbor）。
- [ ]  **9.4** 写 `deploy-k8s.sh`：`kubectl apply` 执行 `deploy/k8s/` 下清单。
- [ ]  **9.5** 在 `.github/workflows/` 下写流水线（或 GitLab 的 `.gitlab-ci.yml`）：拉代码 → 各服务编译/测试 → 前端 build → 构建镜像 → 推送镜像；可选部署到 K8s。
- [ ]  **9.6** 提交代码触发流水线，确认构建与镜像推送成功；若有部署，确认 K8s 中服务更新正常。

---

## 阶段十：扩展功能（后续讨论）

- [ ]  **10.1** 与需求一起确定扩展内容（如：全文搜索、文件上传、统计报表、管理端权限等），再拆成类似上面的细步骤并逐项打勾。

---

## 进度小结（按阶段勾选情况判断）


| 阶段 | 说明           | 你做到哪了？看该阶段第一个未勾的步骤编号即可 |
| ---- | -------------- | -------------------------------------------- |
| 一   | 仓库与基础文档 | 1.1 ~ 1.3                                    |
| 二   | 基础设施       | 2.1 ~ 2.11                                   |
| 三   | 认证服务       | 3.1 ~ 3.14                                   |
| 四   | 博客服务       | 4.1 ~ 4.12                                   |
| 五   | 评论服务       | 5.1 ~ 5.10                                   |
| 六   | 网关           | 6.1 ~ 6.7                                    |
| 七   | 前端           | 7.1 ~ 7.19                                   |
| 八   | 部署           | 8.1 ~ 8.7                                    |
| 九   | 脚本与 CI/CD   | 9.1 ~ 9.6                                    |
| 十   | 扩展功能       | 10.1（后续讨论）                             |

完成阶段一至九即可满足任务书中的「微服务 ≥3、容器化、K8s 编排、CI/CD」；第十阶段用于加分与扩展，具体内容后续再定。
