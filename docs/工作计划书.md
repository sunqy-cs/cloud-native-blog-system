# 云原生博客与知识库系统 - 工作计划书

本文档采用**敏捷（Scrum 轻量版）+ 迭代增量 + 垂直切片**：每一轮迭代都完成**一条从前端 → 网关 → 服务 → 数据库的完整可演示链路**，而不是先搭完所有服务骨架再做前端。适合毕设答辩时「每轮都能演示一个完整功能」。

不规定具体时间节点；最后为扩展功能，具体内容后续再定。

---

## 如何使用本计划（打勾看进度）

- **打勾**：把该步骤前的 `- [ ]` 改成 `- [x]`（在方括号里输入字母 x），保存后即可看到勾选效果。
- **看进度**：往下扫一眼，所有已勾选的就是「已完成」，第一个未勾的就是「当前该做的」。
- **迭代验收**：每轮迭代结束时，应能从前端操作到数据库，整条链路可演示。

---

## 迭代 0：准备（仓库 + 基础设施）

**目标**：仓库规范、文档齐全；数据库与本地环境可启动，为后续每条垂直切片提供「数据层 + 运行环境」。

- [ ]  **0.1** 确认根目录有 `.gitignore`，且包含：`target/`、`node_modules/`、`.idea/`、`*.iml`、`dist/`、`.env.local` 等；没有则补充。
- [X]  **0.2** 确认 `docs/` 下已有：`任务书.txt`、`技术栈.md`、本 `工作计划书.md`；根目录有 `README.md`。
- [X]  **0.3** 在项目根下新建目录 `infrastructure/`。
- [ ]  **0.4** 在 `infrastructure/mysql/` 下按「一表一文件」建 SQL（推荐）：
  - **00_init.sql**：建库（如 `CREATE DATABASE blog DEFAULT CHARSET utf8mb4; USE blog;`），或只建库，后续表脚本里用 `USE blog;`。
  - **01_user.sql**、**02_category.sql**、**03_tag.sql**、**04_article.sql**、**05_article_tag.sql**、**06_comment.sql**：各表建表语句（注意外键顺序：先 user/category/tag，再 article，再 article_tag、comment）。
  - 这样便于维护和 Git 历史；MySQL 的 `docker-entrypoint-initdb.d` 会按**文件名顺序**执行，数字前缀保证顺序。
- [ ]  **0.5** （可选）在 `infrastructure/mysql/` 下新建 `data.sql`，写初始管理员、默认分类等。
- [ ]  **0.6** 在 `infrastructure/` 下新建 `docker-compose.yml`：MySQL 8.x、Redis、Nacos（若用）；MySQL 将 **整个目录** `infrastructure/mysql/` 挂载到 `/docker-entrypoint-initdb.d`（会按文件名顺序执行其中所有 `.sql`），端口与后续 `application.yml` 一致（如 3306、6379、8848）。
- [ ]  **0.7** 验收：执行 `docker-compose up -d`，MySQL 可连、库与表已存在。

---

## 迭代 1：垂直切片一 —— 用户注册与登录

**目标**：一条完整链路——**前端登录/注册页 → 网关 → user-service → MySQL**，能注册、登录并拿到 JWT，适合答辩时先演示「用户体系打通」。

### 数据库（迭代 0 已建好 user 表，本步仅确认）

- [ ]  **1.1** 确认 `user` 表存在且字段满足：id, username, password, nickname, role, created_at 等。

### 后端：user-service

- [ ]  **1.2** 在 `services/user-service/` 完善 Maven 工程：`pom.xml` 增加 MySQL 驱动、MyBatis Plus、Spring Security、JWT（如 jjwt）、Lombok；若用 Nacos 则加 Nacos Discovery/Config。
- [ ]  **1.3** 写 `application.yml`：服务名、端口（如 8081）、数据库 URL/用户名/密码（与 infrastructure 一致）。
- [ ]  **1.4** 建包：`controller`、`service`、`service.impl`、`mapper`、`entity`、`config`、`dto`、`util`。
- [ ]  **1.5** 写 `entity/User.java`、`mapper/UserMapper.java`（继承 BaseMapper）、`service/UserService` 及实现（按用户名查、注册、密码加密）。
- [ ]  **1.6** 写 `util/JwtUtil.java`、`config/SecurityConfig.java`（放行 `/user/register`、`/user/login`，其余可先放行或后续迭代再加鉴权）。
- [ ]  **1.7** 写 `controller`：注册 `POST /user/register`、登录 `POST /user/login`（返回 JWT）；启动类已有则跳过。
- [ ]  **1.8** 本地启动 MySQL，运行 user-service，用 REST Client 或 Postman 调注册、登录，确认返回 JWT。

### 网关（本迭代只配 user 路由）

- [ ]  **1.9** 在 `gateway/` 下创建 Maven 工程：`pom.xml`（Spring Cloud Gateway、Nacos Discovery 若用），端口 8080；路由 `/api/user/**` → user-service。
- [ ]  **1.10** 写启动类；鉴权可本迭代先放行全部，或只放行 `/api/user/login`、`/api/user/register`。
- [ ]  **1.11** 启动 gateway、user-service，通过 `http://localhost:8080/api/user/login` 等访问，确认路由正确。

### 前端（本迭代只做登录/注册页 + 请求与状态）

- [ ]  **1.12** 在 `frontend/` 下用 Vite 创建 Vue 3 项目，安装 `vue-router`、`pinia`、`axios`、`element-plus`。
- [ ]  **1.13** 写 `src/api/request.ts`（baseURL 指向 `http://localhost:8080/api`）、`src/stores/user.ts`（Token、登录/登出）、`src/api/auth.ts`（登录、注册接口封装）。
- [ ]  **1.14** 写 `views/Login.vue`：登录/注册表单，调接口、存 Token、跳转首页；`App.vue` + `router`（登录、首页占位即可）。
- [ ]  **1.15** 验收：从前端注册 → 登录 → 拿到 Token、跳转首页；整条链路「前端 → 网关 → user-service → 数据库」可演示。

---

## 迭代 2：垂直切片二 —— 文章列表与详情（只读）

**目标**：**前端首页/列表 → 网关 → blog-service → MySQL**，能浏览文章列表与详情，不写评论、不写后台。

### 数据库（迭代 0 已建好 article、category、tag、article_tag）

- [ ]  **2.1** 确认 `article`、`category`、`tag`、`article_tag` 表存在；若有需要可插入几条测试数据。

### 后端：blog-service

- [ ]  **2.2** 在 `services/blog-service/` 下创建 Maven 工程：`pom.xml`（Spring Boot、MyBatis Plus、MySQL、Nacos、Lombok 等），`application.yml`（端口如 8082、数据库、Nacos）。
- [ ]  **2.3** 写 `entity/Article.java`、`Category.java`、`Tag.java`；`mapper` 继承 BaseMapper；`service` 文章列表（分页）、详情、分类/标签列表。
- [ ]  **2.4** 写 `controller`：文章列表 GET、详情 GET、分类/标签列表；统一返回格式与异常处理（如 `Result<T>`、`@ControllerAdvice`）可在此或迭代 4 补全。
- [ ]  **2.5** 启动 blog-service，用接口测试列表、详情。

### 网关

- [ ]  **2.6** 在 gateway 的 `application.yml` 中增加路由：`/api/blog/**`（或 `/api/articles/**`）→ blog-service。

### 前端

- [ ]  **2.7** 写 `src/api/article.ts`、`category.ts`、`tag.ts`（列表、详情等）；首页/文章列表页 `views/Home.vue` 或 `ArticleList.vue`（列表、分页、点进详情）。
- [ ]  **2.8** 写文章详情页 `views/ArticleDetail.vue`：标题、正文、分类/标签；本迭代可不做评论区。
- [ ]  **2.9** 验收：打开首页看文章列表、点进详情看正文；链路「前端 → 网关 → blog-service → 数据库」可演示。

---

## 迭代 3：垂直切片三 —— 评论

**目标**：**前端文章详情页评论区 → 网关 → comment-service → blog-service（校验文章）→ MySQL**，能看评论、发评论。

### 数据库（迭代 0 已建好 comment 表）

- [ ]  **3.1** 确认 `comment` 表存在（article_id, user_id, content, parent_id 等）。

### 后端：comment-service

- [ ]  **3.2** 在 `services/comment-service/` 下创建 Maven 工程：`pom.xml`（Spring Boot、MyBatis Plus、MySQL、Nacos、OpenFeign），`application.yml`（端口如 8083、Feign 调 blog-service）。
- [ ]  **3.3** 写 `client/BlogServiceClient.java`（如 GET 文章是否存在或详情）；`entity/Comment.java`、`mapper/CommentMapper.java`、`service/CommentService` 及实现（按文章查评论、发表评论时先调 blog 校验文章）。
- [ ]  **3.4** 写 `controller`：按文章查评论 GET、发表评论 POST；启动类。
- [ ]  **3.5** 启动 blog-service、comment-service，调评论接口验证。

### 网关

- [ ]  **3.6** 在 gateway 中增加路由：`/api/comments/**` → comment-service。

### 前端

- [ ]  **3.7** 写 `src/api/comment.ts`（评论列表、发表）；在 `ArticleDetail.vue` 中加评论列表与发表评论表单。
- [ ]  **3.8** 验收：在文章详情页能看到评论、能发评论；链路「前端 → 网关 → comment-service → blog-service + MySQL」可演示。

---

## 迭代 4：垂直切片四 —— 后台文章管理（需登录）

**目标**：**前端后台 → 网关（鉴权）→ blog-service**，登录后能对文章、分类、标签做增删改查；网关对本迭代起对需登录接口做 JWT 校验。

### 网关鉴权

- [ ]  **4.1** 在 gateway 中写全局过滤器：对 `/api/user/login`、`/api/user/register` 放行；其他 `/api/**` 从 Header 取 JWT 校验，无效返回 401；CORS 按需配置。

### 后端：blog-service 补充（若迭代 2 未做全）

- [ ]  **4.2** 文章创建、更新、删除接口；分类/标签的增删改查（若未在迭代 2 实现则在此补）。

### 前端

- [ ]  **4.3** 写后台布局 `views/admin/Layout.vue`（侧栏 + 顶栏 + 内容区）；后台文章管理 `views/admin/ArticleManage.vue`（表格、新增/编辑/删除、调 article/category/tag 接口）。
- [ ]  **4.4** 在 `router` 里加 `beforeEach`：访问后台路径无 Token 则跳转登录页；登录后能从首页或菜单进入后台。
- [ ]  **4.5** （可选）后台分类/标签管理页，或合在文章管理里；按需写 `ArticleCard.vue`、`CommentList.vue` 等组件。
- [ ]  **4.6** 验收：登录后进后台，能增删改查文章与分类/标签；网关鉴权生效（未带 Token 访问后台接口返回 401）。

---

## 迭代 5：容器化与 CI/CD

**目标**：全栈可构建、可镜像化、可部署到 K8s；具备持续集成/持续部署流水线。

- [ ]  **5.1** 为 user-service、blog-service、comment-service、gateway 各写一个 Dockerfile（多阶段：Maven 打包 + JRE 运行 jar）；可放在 `deploy/` 或各服务目录下。
- [ ]  **5.2** （可选）写 `deploy/docker-compose.yml`：MySQL、Redis、Nacos、四个服务一键起，环境变量与端口一致。
- [ ]  **5.3** 在 `deploy/k8s/` 下写基础设施（MySQL、Redis、Nacos 的 Deployment/Service/ConfigMap/Secret 等）及各微服务、gateway 的 Deployment、Service；ConfigMap/Secret 存配置与密码；若需对外访问写 Ingress。
- [ ]  **5.4** 在 `scripts/` 下写构建脚本（各服务 `mvn package`、前端 `npm run build`）、打镜像与推送脚本、`kubectl apply` 部署脚本。
- [ ]  **5.5** 在 `.github/workflows/`（或 GitLab CI）写流水线：拉代码 → 各服务编译/测试 → 前端 build → 构建镜像 → 推送镜像；可选部署到 K8s。
- [ ]  **5.6** 验收：流水线绿；在本地或云上 K8s 集群部署后，能通过浏览器或 curl 访问网关与前端，核心功能可用。

---

## 迭代 6：扩展功能（后续讨论）

- [ ]  **6.1** 与需求一起确定扩展内容（如全文搜索、文件上传、统计报表、管理端权限细化等），再拆成类似上面的细步骤并逐项打勾。

---

## 进度小结（按迭代与垂直切片）


| 迭代 | 垂直切片 / 目标                                              | 你做到哪了？看该迭代第一个未勾的步骤编号即可 |
| ---- | ------------------------------------------------------------ | -------------------------------------------- |
| 0    | 准备：仓库 + 基础设施（DB + docker-compose）                 | 0.1 ~ 0.7                                    |
| 1    | 用户注册与登录（前端 → 网关 → user-service → DB）         | 1.1 ~ 1.15                                   |
| 2    | 文章列表与详情只读（前端 → 网关 → blog-service → DB）     | 2.1 ~ 2.9                                    |
| 3    | 评论（前端 → 网关 → comment-service → blog-service + DB） | 3.1 ~ 3.8                                    |
| 4    | 后台文章管理 + 网关鉴权                                      | 4.1 ~ 4.6                                    |
| 5    | 容器化与 CI/CD                                               | 5.1 ~ 5.6                                    |
| 6    | 扩展功能                                                     | 6.1（后续讨论）                              |

完成迭代 0～5 即可满足任务书中的「微服务 ≥3、容器化、K8s 编排、CI/CD」；每轮迭代都有一条可演示的完整链路，适合毕设答辩分阶段展示。迭代 6 用于加分与扩展，具体内容后续再定。
