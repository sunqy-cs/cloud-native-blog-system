server:
  port: 8080

spring:
  application:
    name: gateway-service
  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848
        username: nacos
        password: nacos
    gateway:
      discovery:
        locator:
          enabled: true
      globalcors:
        add-on-simple-url-handler-mapping: true
        cors-configurations:
          '[/**]':
            allowedOrigins: "*"
            allowedMethods: "*"
            allowedHeaders: "*"
      routes:
        # 用户服务：登录、注册、当前用户、登出（lb = LoadBalancer，从 Nacos 解析实例）
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/api/sessions/**,/api/users/**
          order: 1
        # 文件服务：对象存储
        - id: file-service
          uri: lb://file-service
          predicates:
            - Path=/api/objects,/api/objects/**
          order: 2
        # 内容/博客服务：我的博客列表
        - id: content-service
          uri: lb://content-service
          predicates:
            - Path=/api/contents/**
          order: 3
        # 内容服务：收藏夹
        - id: content-service-folders
          uri: lb://content-service
          predicates:
            - Path=/api/collection-folders/**
          order: 3
        # 内容服务：专栏
        - id: content-service-columns
          uri: lb://content-service
          predicates:
            - Path=/api/columns/**
          order: 3
        # AI 服务：博客机器人
        - id: ai-service-blog-bots
          uri: lb://ai-service
          predicates:
            - Path=/api/blog-bots/**
          order: 3
        # 内容服务：标签（主标签列表等）
        - id: content-service-tags
          uri: lb://content-service
          predicates:
            - Path=/api/tags/**
          order: 3
        # 互动服务：评论（有评论的文章、评论列表、热评）
        - id: interaction-service-comments
          uri: lb://interaction-service
          predicates:
            - Path=/api/comments/**
          order: 3
        # 互动服务：赞同（我赞同的文章）
        - id: interaction-service-likes
          uri: lb://interaction-service
          predicates:
            - Path=/api/content-likes/**
          order: 3
        # 互动服务：关注统计
        - id: interaction-service-follow
          uri: lb://interaction-service
          predicates:
            - Path=/api/follow/**
          order: 3
        # AI 服务：生成标题等
        - id: ai-service
          uri: lb://ai-service
          predicates:
            - Path=/api/ai/**
          order: 3
        # 博客服务（若有）
        - id: blog-service
          uri: lb://blog-service
          predicates:
            - Path=/api/posts/**,/api/articles/**
          order: 4

# 与 user-service 一致，用于网关统一鉴权
jwt:
  secret: your-256-bit-secret-key-change-in-production-please

# 无需 JWT 的白名单：Method:Path（正则或 Ant 风格）
gateway:
  auth:
    permit-all:
      - "POST:/api/sessions"
      - "POST:/api/users"
      # GET 图片流式地址（?stream=1）用于编辑器/文章内展示，不携带 Token 也放行
      - "GET:/api/objects/**"
      # 推荐页公开列表（已发布博客，按主标签/最新）
      - "GET:/api/contents/list"
      # 文章公开阅读（已发布博客）
      - "GET:/api/contents/view/**"
      # 按 ID 获取用户公开资料（昵称、头像），用于文章页作者展示
      - "GET:/api/users/**"
      # 按 userId 获取专栏列表（公开），用于他人博客页「全部/专栏」导航
      - "GET:/api/columns/list"
      # 指定用户的关注统计（公开），用于他人个人主页展示关注者数
      - "GET:/api/follow/stats"
